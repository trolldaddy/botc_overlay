<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BOTC Overlay 測試成功！</title>
  <style>
    body { margin: 0; background: rgba(0, 0, 0, 0.9); font-family: Arial, sans-serif; color: white; }
    #toggleButton {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: black; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer;
    }
    .panel {
      position: fixed; top: 0; bottom: 0; width: 300px; background: rgba(0,0,0,0.9); overflow-y: auto;
      transition: transform 0.3s ease;
    }
    #leftPanel { left: 0; transform: translateX(-100%); }
    #rightPanel { right: 0; transform: translateX(100%); }
    .panel.open { transform: translateX(0); }
    h2 { border-bottom: 1px solid #fff; padding-bottom: 5px; }
    .role-entry { display: inline-block; text-align: center; margin: 5px; }
    .role-entry img { width: 50px; height: 50px; display: block; margin: 0 auto; }
  </style>
</head>
<body>
  <button id="toggleButton">顯示角色資訊</button>
  <div id="leftPanel" class="panel"></div>
  <div id="rightPanel" class="panel"></div>

  <script>
    let panelsVisible = false;

    const toggleButton = document.getElementById('toggleButton');
    const leftPanel = document.getElementById('leftPanel');
    const rightPanel = document.getElementById('rightPanel');

    toggleButton.addEventListener('click', () => {
      panelsVisible = !panelsVisible;
      if (panelsVisible) {
        leftPanel.classList.add('open');
        rightPanel.classList.add('open');
        loadRoles();
      } else {
        leftPanel.classList.remove('open');
        rightPanel.classList.remove('open');
      }
    });

    async function loadRoles() {
      const customListRes = await fetch('/custom-list.json');
      const customList = await customListRes.json();

      const referenceRes = await fetch('/role_reference_trouble_brewing.json');
      const reference = await referenceRes.json();

      const roleMap = reference;

      const leftContent = ['<h2>鎮民</h2>'];
      const rightContent = ['<h2>外來者</h2>', '<br><h2>爪牙</h2>', '<br><h2>惡魔</h2>'];

      customList.forEach(role => {
        const roleData = roleMap[role.id];
        if (!roleData) return;

        const html = `
          <div class="role-entry">
            <img src="${roleData.image}" alt="${roleData.name_zh || role.id}">
            <div>${roleData.name_zh || role.id}</div>
          </div>
        `;

        if (roleData.team === '鎮民') {
          leftContent.push(html);
        } else if (roleData.team === '外來者') {
          rightContent.splice(1, 0, html);
        } else if (roleData.team === '爪牙') {
          rightContent.splice(3, 0, html);
        } else if (roleData.team === '惡魔') {
          rightContent.push(html);
        }
      });

      leftPanel.innerHTML = leftContent.join('');
      rightPanel.innerHTML = rightContent.join('');
    }

    // Twitch Extension Helper Integration
    if (window.Twitch && window.Twitch.ext) {
      window.Twitch.ext.onAuthorized(auth => {
        console.log('Twitch Extension Authorized', auth);
      });
    }
  </script>
</body>
</html>
