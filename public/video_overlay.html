<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>BOTC Overlay 測試成功！</title>
  <script src="https://extension-files.twitch.tv/helper/v1/twitch-ext.min.js"></script>
  <style>
    body { margin: 0; background: rgba(0, 0, 0, 0.8); color: white; font-family: Arial, sans-serif; }
    #toggleButton {
      position: fixed; bottom: 20px; left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px; background: #111; color: white;
      border: none; border-radius: 5px; cursor: pointer;
    }
    .panel {
      position: fixed; top: 0; bottom: 0; width: 30%;
      background: rgba(0, 0, 0, 0.9); overflow-y: auto; padding: 10px;
      transition: transform 0.3s ease;
    }
    #leftPanel { left: 0; transform: translateX(-100%); }
    #rightPanel { right: 0; transform: translateX(100%); }
    .panel.show { transform: translateX(0); }
    .category-title { font-size: 1.5em; margin: 10px 0; }
    .role-item { display: inline-block; margin: 5px; text-align: center; position: relative; }
    .role-item img { width: 50px; height: 50px; display: block; margin: auto; }
    .tooltip {
      visibility: hidden; background: #333; color: #fff; text-align: left;
      border-radius: 5px; padding: 5px; position: absolute; bottom: 60px;
      left: 50%; transform: translateX(-50%); z-index: 1; white-space: nowrap;
    }
    .role-item:hover .tooltip { visibility: visible; }
  </style>
</head>
<body>
  <button id="toggleButton">顯示角色資訊</button>
  <div id="leftPanel" class="panel"></div>
  <div id="rightPanel" class="panel"></div>

  <script>
    const toggleButton = document.getElementById('toggleButton');
    const leftPanel = document.getElementById('leftPanel');
    const rightPanel = document.getElementById('rightPanel');
    let panelsVisible = false;

    toggleButton.addEventListener('click', () => {
      panelsVisible = !panelsVisible;
      leftPanel.classList.toggle('show', panelsVisible);
      rightPanel.classList.toggle('show', panelsVisible);
    });

    async function loadAndRender() {
      console.log("開始載入角色資料");
      const customList = await fetch('/custom-list.json').then(r => r.json());
      const roleRef = await fetch('/role_reference_trouble_brewing.json').then(r => r.json());

      const roleMap = {};
      for (const id in roleRef) roleMap[id] = roleRef[id];

      const teams = { town: [], outsider: [], minion: [], demon: [] };
      customList.forEach(role => {
        const data = roleMap[role.id] || {};
        const team = data.team || role.type || 'unknown';
        teams[team]?.push({ ...role, ...data });
      });

      leftPanel.innerHTML = `<div class="category-title">鎮民</div>${renderRoles(teams.town)}`;
      rightPanel.innerHTML = `
        <div class="category-title">外來者</div>${renderRoles(teams.outsider)}
        <div class="category-title">爪牙</div>${renderRoles(teams.minion)}
        <div class="category-title">惡魔</div>${renderRoles(teams.demon)}
      `;
    }

    function renderRoles(roles) {
      return roles.map(role => `
        <div class="role-item">
          <img src="${role.image || ''}" alt="${role.name_zh || role.name}">
          <div>${role.name_zh || role.name}</div>
          <div class="tooltip">${role.ability || '無能力說明'}</div>
        </div>
      `).join('');
    }

    loadAndRender();
  </script>
</body>
</html>
