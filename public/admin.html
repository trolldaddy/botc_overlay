<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>實況主座位管理介面</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    select { margin-left: 10px; }
    .seat { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>血染鐘樓座位管理</h1>
  <p>請為每個座位分配角色。<br>角色選單會根據 <code>custom-list.json</code> 自動載入。</p>
  <div id="seating-form"></div>
  <button onclick="saveSeating()">儲存設定</button>

  <script>
    const seatCount = 15;
    let characterList = [];

    // 載入角色清單
    fetch('custom-list.json')
      .then(response => response.json())
      .then(data => {
        characterList = data;
        buildForm();
      });

    // 產生表單
    function buildForm() {
      const container = document.getElementById('seating-form');
      for (let i = 1; i <= seatCount; i++) {
        const seatDiv = document.createElement('div');
        seatDiv.className = 'seat';
        seatDiv.innerHTML = `座位 ${i}: <select id="seat-${i}"><option value="">（未指定）</option></select>`;
        container.appendChild(seatDiv);

        const select = seatDiv.querySelector('select');
        characterList.forEach(char => {
          const option = document.createElement('option');
          option.value = char.id;
          option.textContent = char.id;
          select.appendChild(option);
        });
      }
    }

    // 提交設定
    function saveSeating() {
      const seating = {};
      for (let i = 1; i <= seatCount; i++) {
        const value = document.getElementById(`seat-${i}`).value;
        seating[`seat${i}`] = value;
      }

      fetch('/api/seating', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(seating)
      }).then(() => alert('座位設定已儲存'));
    }
  </script>
</body>
</html>
